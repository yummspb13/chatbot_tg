# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Vercel –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## –ü—Ä–æ–±–ª–µ–º–∞

Worker —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ webhook, –Ω–æ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ –≥—Ä—É–ø–ø—É.

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö Vercel

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è webhook

–û—Ç–∫—Ä–æ–π—Ç–µ Vercel Dashboard ‚Üí –≤–∞—à –ø—Ä–æ–µ–∫—Ç ‚Üí Logs

**–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Worker –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**

```
üì• WEBHOOK RECEIVED: message
üì• Full update: {...}
üì® MESSAGE:
    chatType=channel
    chatId=-1003442736774
    text="..."
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞

**–î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:**

```
üì® [HANDLER] –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –∫–∞–Ω–∞–ª–∞ (–æ—Ç worker)!
   Chat ID: -1003442736774
   Chat Title: –¢–µ—Å—Ç –ö–∏–¥–¥
   Message ID: 67
   Text length: 553
   Has forward_from_chat: true
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ handleChannelMessage

**–î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:**

```
üîµ handleChannelMessage –í–´–ó–í–ê–ù
   Update Type: message
   Chat Type: channel
   Chat ID: -1003442736774
   Has message: true
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:**

```
üîç STEP1: FIND_CHANNEL_IN_DB
   –ò—â—É –∫–∞–Ω–∞–ª —Å chatId: -1003442736774
   ‚úÖ –ö–∞–Ω–∞–ª –Ω–∞–π–¥–µ–Ω: –¢–µ—Å—Ç –ö–∏–¥–¥
```

**–ò–ª–∏ –µ—Å–ª–∏ –∫–∞–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω:**

```
   ‚ùå –ö–∞–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
   üí° –î–æ–±–∞–≤—å—Ç–µ –∫–∞–Ω–∞–ª —á–µ—Ä–µ–∑ /addchannel
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–∞—Ä—Ç–æ—á–∫–∏

**–î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:**

```
üì§ STEP6: SEND_APPROVAL_CARD (BEFORE DRAFT CREATION)
üì§ SENDING: approval card to group -4993347411
üì§ ‚úÖ SENT: approval card sent to group
```

**–ò–ª–∏ –µ—Å–ª–∏ –æ—à–∏–±–∫–∞:**

```
‚ùå ERROR sending approval card: ...
   Chat ID: -4993347411
   Error code: ...
   üí° –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
      1. –ë–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä?
      2. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ ID –≥—Ä—É–ø–ø—ã?
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö –µ—Å—Ç—å `üì• WEBHOOK RECEIVED: message`
- –ù–æ –Ω–µ—Ç `üì® [HANDLER] –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –∫–∞–Ω–∞–ª–∞`

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `chat.type === 'channel'` –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É update –æ—Ç Worker

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ö–∞–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö: `‚ùå –ö–∞–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö`

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞–Ω–∞–ª—ã –≤ –±–∞–∑–µ: `npm run check:channels:db`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `chatId` —Å–æ–≤–ø–∞–¥–∞–µ—Ç: `-1003442736774`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–∞–Ω–∞–ª –∞–∫—Ç–∏–≤–µ–Ω: `isActive = true`

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–∞—Ä—Ç–æ—á–∫–∏

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö: `‚ùå ERROR sending approval card`

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TELEGRAM_PUBLISH_GROUP_ID=-4993347411` –≤ Vercel
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º)

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –û—à–∏–±–∫–∞ –≤ handleChannelMessage

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö: `‚ùå –û—à–∏–±–∫–∞ –≤ handleChannelMessage: ...`

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª–Ω—ã–π stack trace –≤ –ª–æ–≥–∞—Ö
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (AI_PROVIDER, OPENAI_API_KEY –∏ —Ç.–¥.)

## –ü–æ—à–∞–≥–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

1. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª**
2. **–°—Ä–∞–∑—É –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Vercel** (–Ω–µ –∂–¥–∏—Ç–µ, –ª–æ–≥–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)
3. **–ò—â–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É:**
   - `üì• WEBHOOK RECEIVED: message`
   - `üì® [HANDLER] –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –∫–∞–Ω–∞–ª–∞`
   - `üîµ handleChannelMessage –í–´–ó–í–ê–ù`
   - `‚úÖ –ö–∞–Ω–∞–ª –Ω–∞–π–¥–µ–Ω`
   - `üì§ SENDING: approval card`
   - `üì§ ‚úÖ SENT: approval card`

4. **–ï—Å–ª–∏ –∫–∞–∫–∞—è-—Ç–æ —Å—Ç—Ä–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç** - –ø—Ä–æ–±–ª–µ–º–∞ –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Vercel
3. –ù–∞–π–¥–∏—Ç–µ, –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
4. –ò—Å–ø—Ä–∞–≤—å—Ç–µ –ø—Ä–æ–±–ª–µ–º—É —Å–æ–≥–ª–∞—Å–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –≤—ã—à–µ

