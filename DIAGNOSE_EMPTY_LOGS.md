# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: Worker –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ –∫–∞–Ω–∞–ª–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

Worker –∑–∞–ø—É—â–µ–Ω –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω, –Ω–æ –ª–æ–≥–∏ –ø—É—Å—Ç—ã–µ - –Ω–µ—Ç —Å–æ–±—ã—Ç–∏–π –∏–∑ –∫–∞–Ω–∞–ª–æ–≤.

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. –ê–∫–∫–∞—É–Ω—Ç –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∫–∞–Ω–∞–ª

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∞–∫–∫–∞—É–Ω—Ç (–∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `TELEGRAM_SESSION_STRING`) –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∫–∞–Ω–∞–ª
- –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –Ω–∞ —ç—Ç–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –∫–∞–Ω–∞–ª —Å –∞–∫–∫–∞—É–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Worker

### 2. Worker –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å Client API

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Worker –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
  ```
  ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ Telegram —á–µ—Ä–µ–∑ Client API
  üì° –ù–∞—á–∏–Ω–∞—é –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ X –∫–∞–Ω–∞–ª–æ–≤...
  ‚úÖ Channels map —Å–æ–∑–¥–∞–Ω, —Ä–∞–∑–º–µ—Ä: X
  üì° –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π...
  ```

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Worker:
  ```bash
  curl -X POST https://chatbot-tg.onrender.com/runner/stop
  curl -X POST https://chatbot-tg.onrender.com/runner/start
  ```

### 3. –ö–∞–Ω–∞–ª –Ω–µ –≤ —Å–ø–∏—Å–∫–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
npm run check:channels:db
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
- –ö–∞–Ω–∞–ª –µ—Å—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- `isActive = true`
- `chatId` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `-100`)

**–†–µ—à–µ–Ω–∏–µ:**
- –ï—Å–ª–∏ –∫–∞–Ω–∞–ª–∞ –Ω–µ—Ç –∏–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω - –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –µ–≥–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### 4. –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Å—Å–∏–µ–π Telegram

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TELEGRAM_SESSION_STRING` –≤ Render.com
- –°–µ—Å—Å–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–π –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–≤—à–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é:
   - –û—Ç–∫—Ä–æ–π—Ç–µ `https://chatbot-tg.onrender.com/auth/qr/start`
   - –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `sessionString`
2. –û–±–Ω–æ–≤–∏—Ç–µ –≤ Render.com ‚Üí Environment ‚Üí `TELEGRAM_SESSION_STRING`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Worker

### 5. –°–æ–±—ã—Ç–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç, –Ω–æ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –í–°–ï —Å–æ–±—ã—Ç–∏—è
- –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è `UpdateConnectionState`, `UpdateUserStatus` –∏ —Ç.–¥., –Ω–æ –Ω–µ—Ç `UpdateNewChannelMessage` - –∑–Ω–∞—á–∏—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ –∫–∞–Ω–∞–ª–∞ –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–∞ –∫–∞–Ω–∞–ª
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ –∫–∞–Ω–∞–ª–µ

## –ü–æ—à–∞–≥–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–Ω–∞–ª–æ–≤ –≤ –±–∞–∑–µ

```bash
npm run check:channels:db
```

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–Ω–∞–ª—ã.

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Worker

```bash
npm run check:worker:status
```

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
- `isRunning: true`
- `isMonitoring: true`
- `isConnected: true`

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Worker

–û—Ç–∫—Ä–æ–π—Ç–µ Render.com Dashboard ‚Üí –≤–∞—à Worker ‚Üí Logs

**–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
üì° –ù–∞—á–∏–Ω–∞—é –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ 1 –∫–∞–Ω–∞–ª–æ–≤...
   üìã –°–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤:
      - –¢–µ—Å—Ç –ö–∏–¥–¥ (-1003442736774)
   ‚úÖ Channels map —Å–æ–∑–¥–∞–Ω, —Ä–∞–∑–º–µ—Ä: 1
   üì° –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π...
```

**–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:**
```
üì• EVENT: UpdateNewChannelMessage
   ‚úÖ –≠—Ç–æ —Å–æ–±—ã—Ç–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (UpdateNewChannelMessage)
   ‚úÖ Event has message
   Message ID: ...
   üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –∫–∞–Ω–∞–ª–∞ –¢–µ—Å—Ç –ö–∏–¥–¥ (-1003442736774)
```

### –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª `-1003442736774`
2. –°—Ä–∞–∑—É –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Worker
3. –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ—è–≤–∏–ª–æ—Å—å - –ø—Ä–æ–±–ª–µ–º–∞ –≤ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏–π

## –†–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Worker

```bash
curl -X POST https://chatbot-tg.onrender.com/runner/stop
curl -X POST https://chatbot-tg.onrender.com/runner/start
```

### –†–µ—à–µ–Ω–∏–µ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ `https://chatbot-tg.onrender.com/auth/qr/start`
2. –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `sessionString`
4. –û–±–Ω–æ–≤–∏—Ç–µ –≤ Render.com
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Worker

### –†–µ—à–µ–Ω–∏–µ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∞–∫–∫–∞—É–Ω—Ç –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∫–∞–Ω–∞–ª
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ –∫–∞–Ω–∞–ª–µ

### –†–µ—à–µ–Ω–∏–µ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ chatId

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `chatId` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (`-1003442736774`) —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º ID –∫–∞–Ω–∞–ª–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `/channel:get-id` –∏–ª–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª
2. –°—Ä–∞–∑—É –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Worker –≤ Render.com
3. –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è (–ª—é–±—ã–µ) - –∑–Ω–∞—á–∏—Ç Worker –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ –Ω–µ —Ç–µ
4. –ï—Å–ª–∏ –Ω–µ –≤–∏–¥–∏—Ç–µ –Ω–∏–∫–∞–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π - –ø—Ä–æ–±–ª–µ–º–∞ –≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∏–ª–∏ –ø–æ–¥–ø–∏—Å–∫–µ

## –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ Worker –±—É–¥–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –í–°–ï —Å–æ–±—ã—Ç–∏—è, –≤–∫–ª—é—á–∞—è:
- `UpdateConnectionState`
- `UpdateUserStatus`
- `UpdateNewChannelMessage`
- –ò –¥—Ä—É–≥–∏–µ

–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å, –ø–æ–ª—É—á–∞–µ—Ç –ª–∏ Worker —Å–æ–±—ã—Ç–∏—è –≤–æ–æ–±—â–µ.

