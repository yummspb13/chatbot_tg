# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å Worker

## –ü—Ä–æ–±–ª–µ–º–∞: Worker –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∫–∞–Ω–∞–ª–æ–≤

### –°–∏–º–ø—Ç–æ–º—ã:
- –õ–æ–≥–∏ Worker –ø—É—Å—Ç—ã–µ
- –°–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª–µ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
- –í Vercel –µ—Å—Ç—å –ª–æ–≥–∏ webhook, –Ω–æ –æ–Ω–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –±–µ–∑ –¥–µ—Ç–∞–ª–µ–π

## –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Worker

```bash
npm run check:worker:status
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:

```bash
curl https://chatbot-tg.onrender.com/runner/status
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "isRunning": true,
  "monitoring": {
    "isMonitoring": true,
    "isConnected": true
  },
  "envCheck": {
    "hasSessionString": true,
    "hasApiId": true,
    "hasApiHash": true,
    "hasMainAppUrl": true,
    "mainAppUrl": "https://chatbot-tg.vercel.app",
    "hasBotApiKey": true
  }
}
```

### –ï—Å–ª–∏ `isRunning: false`:
Worker –Ω–µ –∑–∞–ø—É—â–µ–Ω. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ:

```bash
curl -X POST https://chatbot-tg.onrender.com/runner/start
```

### –ï—Å–ª–∏ `isMonitoring: false`:
–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ –∑–∞–ø—É—â–µ–Ω. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
- –ù–µ—Ç –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ Telegram
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –ï—Å–ª–∏ `isConnected: false`:
Worker –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ Telegram. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- `TELEGRAM_SESSION_STRING` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –≤–∞–ª–∏–¥–µ–Ω
- `TELEGRAM_API_ID` –∏ `TELEGRAM_API_HASH` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Worker –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

## –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–Ω–∞–ª–æ–≤

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–∞–Ω–∞–ª—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –∞–∫—Ç–∏–≤–Ω—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
   ```sql
   SELECT chatId, title, isActive FROM Channel WHERE isActive = true;
   ```

2. –ò–ª–∏ —á–µ—Ä–µ–∑ API (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω):
   ```bash
   curl -H "Authorization: Bearer YOUR_BOT_API_KEY" \
        https://chatbot-tg.vercel.app/api/channels
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `chatId` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º ID –∫–∞–Ω–∞–ª–∞

## –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Worker

–û—Ç–∫—Ä–æ–π—Ç–µ Render.com Dashboard ‚Üí –≤–∞—à Worker ‚Üí Logs

**–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
üöÄ Telegram Client API Worker –∑–∞–ø—É—â–µ–Ω
‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ Telegram —á–µ—Ä–µ–∑ Client API
üì° –ù–∞—á–∏–Ω–∞—é –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ X –∫–∞–Ω–∞–ª–æ–≤...
   üìã –°–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤:
      - –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ (-1001234567890)
   ‚úÖ Channels map —Å–æ–∑–¥–∞–Ω, —Ä–∞–∑–º–µ—Ä: X
   üì° –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π...
‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω
```

**–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
üì• EVENT: UpdateNewChannelMessage
   ‚úÖ –≠—Ç–æ —Å–æ–±—ã—Ç–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (UpdateNewChannelMessage)
   ‚úÖ Event has message
   Message ID: 123
   üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –∫–∞–Ω–∞–ª–∞ –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ (-1001234567890)
   üîÑ –û—Ç–ø—Ä–∞–≤–ª—è—é —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É –Ω–∞ https://chatbot-tg.vercel.app/api/tg/webhook...
   ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –±–æ—Ç—É —á–µ—Ä–µ–∑ webhook
```

## –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Vercel

–û—Ç–∫—Ä–æ–π—Ç–µ Vercel Dashboard ‚Üí –≤–∞—à –ø—Ä–æ–µ–∫—Ç ‚Üí Logs

**–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Worker –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
üöÄ Webhook endpoint initialized
   Environment: PRODUCTION
   AI Provider: OPENAI (openai)
üì• WEBHOOK RECEIVED: message
üì• Full update: {...}
üì® MESSAGE:
    chatType=channel
    chatId=-1001234567890
    text="..."
‚úÖ WEBHOOK: processed in ...ms
```

## –®–∞–≥ 5: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Worker –Ω–µ –∑–∞–ø—É—â–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```bash
curl -X POST https://chatbot-tg.onrender.com/runner/start
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ—Ç –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö: `‚ö†Ô∏è –ù–µ—Ç –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞`
- `isMonitoring: false`

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤—å—Ç–µ –∫–∞–Ω–∞–ª—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `isActive = true`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Worker

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Worker –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ Telegram

**–°–∏–º–ø—Ç–æ–º—ã:**
- `isConnected: false`
- –í –ª–æ–≥–∞—Ö –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TELEGRAM_SESSION_STRING` –≤ Render.com
2. –ï—Å–ª–∏ —Å–µ—Å—Å–∏—è –Ω–µ–≤–∞–ª–∏–¥–Ω–∞, —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é:
   - –û—Ç–∫—Ä–æ–π—Ç–µ `https://chatbot-tg.onrender.com/auth/qr/start`
   - –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `sessionString`
   - –û–±–Ω–æ–≤–∏—Ç–µ –≤ Render.com ‚Üí Environment

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –°–æ–±—ã—Ç–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- Worker –∑–∞–ø—É—â–µ–Ω –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω
- –ù–æ –≤ –ª–æ–≥–∞—Ö –Ω–µ—Ç —Å–æ–±—ã—Ç–∏–π `UpdateNewMessage` –∏–ª–∏ `UpdateNewChannelMessage`

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –ê–∫–∫–∞—É–Ω—Ç –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∫–∞–Ω–∞–ª
2. –ö–∞–Ω–∞–ª –Ω–µ –≤ —Å–ø–∏—Å–∫–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
3. –ü—Ä–æ–±–ª–µ–º—ã —Å Client API

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∞–∫–∫–∞—É–Ω—Ç (–∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `TELEGRAM_SESSION_STRING`) –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∫–∞–Ω–∞–ª
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `chatId` –∫–∞–Ω–∞–ª–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å ID –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Worker –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞ 5: Worker –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ webhook

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö Worker: `‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –±–æ—Ç—É: ...`
- –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ Vercel

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `MAIN_APP_URL` –≤ Render.com - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `https://chatbot-tg.vercel.app`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å webhook:
   ```bash
   curl https://chatbot-tg.vercel.app/api/tg/webhook
   ```
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Worker –Ω–∞ –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏

## –®–∞–≥ 6: –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ Worker

–ï—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

```bash
curl -X POST https://chatbot-tg.onrender.com/runner/start
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–≤–µ—Ç:
```json
{
  "success": true,
  "message": "–í–æ—Ä–∫–µ—Ä –∑–∞–ø—É—â–µ–Ω",
  "isRunning": true,
  "monitoring": true
}
```

–ï—Å–ª–∏ `monitoring: false`, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Worker –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.

## –®–∞–≥ 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Worker - –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–±—ã—Ç–∏–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Vercel - –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è webhook —Å–æ–±—ã—Ç–∏–µ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥—Ä—É–ø–ø—É - –¥–æ–ª–∂–Ω–∞ –ø—Ä–∏–π—Ç–∏ –∫–∞—Ä—Ç–æ—á–∫–∞

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Worker
npm run check:worker:status

# –ó–∞–ø—É—Å–∫ Worker
curl -X POST https://chatbot-tg.onrender.com/runner/start

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ Worker
curl -X POST https://chatbot-tg.onrender.com/runner/stop

# –ü—Ä–æ–≤–µ—Ä–∫–∞ health
curl https://chatbot-tg.onrender.com/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook
curl https://chatbot-tg.vercel.app/api/tg/webhook
```

